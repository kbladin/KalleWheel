<!doctype html>

<html>
<head>
<meta charset="utf-8">
<script src="./ext.js"></script>
<script src="./lib/CSInterface-4.0.0.js"></script>
<script src="./chroma.min.js" type="text/javascript"></script>
<script src="./wheel.js" type="text/javascript"></script>
      
<link id="ppstyle" rel="stylesheet" type="text/css" href="./style.css">
<title>KalleWheel</title>
</head>

<body onLoad="onLoaded()">

<canvas id="wheelCanvas" width="100" height="100" class="unselectable"></canvas>
<canvas id="dotsCanvas" width="600" height="600" class="unselectable" onmousemove="moveDots(event)" onmousedown="mouseDown(event)" onmouseup="mouseUp()" onmouseout="mouseUp()"></canvas>
<input id="lightnessSlider" type="range" class="unselectable" onchange="update()" onmouseup="updateForegroundColor()" onmouseout="updateForegroundColor()">
<form id="colorButtons" class="unselectable"></form>

<script>

function radioButtonChanged() {
      cs.clearCanvas();
      cs.drawCross(0,0);
      cs.drawDots();
      updateForegroundColor();
}

function updateForegroundColor() {
      var form = document.getElementById("colorButtons");
      
      var RGB = cs.colorDots[form.elements["color"].value].color.rgb();
      var js = "setForegroundColorRGB(" + RGB[0] + "," + RGB[1] + "," + RGB[2] + ");";
      var csInterface = new CSInterface();
      csInterface.evalScript(js);
}
      
function mouseDown(e) {
      var mouse = cs.getMouse(e);
      cs.updateSelectedIndex(mouse.x, mouse.y, 0.1);
      cs.mouseDown = true;
      moveDots(e);
}

function mouseUp(e) {
      cs.mouseDown = false;
      updateForegroundColor();
      document.activeElement.blur();
}
      
function update() {
      bc.updateColors();
      cs.clearCanvas();
      cs.drawCross(0,0);
      cs.drawDots();
}

function moveDots(e) {
      var mouse = cs.getMouse(e);
      if (cs.positionOverDots(mouse.x, mouse.y, 0.1)) {
            cs.canvas.style.cursor="crosshair";
      }
      else {
            cs.canvas.style.cursor="default";
      }
      if (cs.mouseDown) {
            cs.moveDots(e);
            cs.clearCanvas();
            cs.drawCross(0,0);
            cs.drawDots();
      }
}

var bc = new BackgroundCanvas(document.getElementById("wheelCanvas"));
var cs = new CanvasState(document.getElementById("dotsCanvas"));
cs.colorDots[0] = new ColorDot(0,0);
cs.colorDots[1] = new ColorDot(0.5,0.6);
cs.colorDots[2] = new ColorDot(0.2,0.8);
cs.colorDots[3] = new ColorDot(-0.2,0.8);
cs.colorDots[4] = new ColorDot(0.2,-0.8);

cs.addColorButtons(document.getElementById("colorButtons"));

update();



</script>

<!--
<div id="wrapper">
                        <input id="lightnessSlider" type="range" class="vVertical" onmousemove="updateColors()">

      <div id="wheel">

      </div>
</div>
-->
</body>

</html>
